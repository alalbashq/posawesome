<!DOCTYPE html>
<html lang="{{ lang }}" dir="{{ layout_direction }}">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>{{ title }}</title>
	<meta name="generator" content="frappe">
	{{ include_style('print.bundle.css') }}
	{% if print_style %}
		<style>
		{{ print_style }}
		</style>
	{% endif %}

	<style>
     
* {
    -webkit-box-sizing: border-box;
    -khtml-box-sizing: border-box;
    -moz-box-sizing: border-box;
    -ms-box-sizing: border-box;
    -o-box-sizing: border-box;
    box-sizing: border-box;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    -o-user-select: none;
    user-select: none;
}
.printview {
    margin-left: auto;
    margin-right: auto;
    width: 70%;    
}
.toolbar {
    background: none repeat scroll 0% 0% rgba(0, 0, 255, 0.3);
    background-color: rgb(71, 71, 71);
    min-height: 32px;
    width: 100%;
    box-shadow: 1px 0px 0px rgba(255, 255, 255, 0.08) inset, 0px 1px 1px rgba(0, 0, 0, 0.15) inset, 0px -1px 0px rgba(255, 255, 255, 0.05) inset, 0px 1px 0px rgba(0, 0, 0, 0.15), 0px 1px 1px rgba(0, 0, 0, 0.1);
    padding: 0;
    position: absolute;
    left: 0px;
    top: 0px;
    display: none;
}
.page-print {
    width: 21cm;
    min-height: 29.7cm;
    /* padding: 0.5cm 1.0cm 0.2cm 1.0cm; */
    padding: 0.5cm 0.5cm 0.2cm 0.5cm;
    margin-top: 5%;
    /* margin-left: 5%; */
    /* border: 1px #D3D3D3 solid; */
    background-color: white;
    /*background-image: url("http://subtlepatterns.com/patterns/lightpaperfibers.png");*/
    /* box-shadow: 0 0 5px rgba(0, 0, 0, 0.8); */
    border: 1px solid #D3D3D3;
}
.printview:first-child {
    margin-top: 5%;    
}
.page:last-child {
    margin-bottom: 5%;
}
.page-header {
   
    text-align: center;
}
.page-body {
    padding: 0.2cm;
   
    height: 265mm;
    /* text-align:justify; */
    text-justify:inter-word;
    font-size: 12px !important;
}
.page-footer {
    bottom: 0;
    /* padding: 0.2cm; */
    /* border-right: 1px #ccc dotted;
    border-bottom: 1px #ccc dotted; */
    /* border-left: 1px #ccc dotted; */
    /* height: 20mm; */
    position: relative;
    text-align: right;
}

.letter-head-footer hr{
    display: none;
}
.letter-head-footer{
        text-align: center; 
        /* direction: rtl;  */
        /* position: fixed;  */
        font-weight: bold !important;
        /* position: absolute; */
        /* bottom: 0; */
        font-size: 11px !important;
        display: block !important;
        /* left: 0; 
        right: 0; 
        margin: 0;  */
        /* bottom: 2px;  */
        /* padding-top: 30px; */
        bottom: -55px !important;
        font-size: 12px;
        padding: 13px 0 0px;
        border-top: 2px solid rgb(29, 29, 29);
    }
    
    .footer-pagination {
        /* margin-bottom: 12px; */
        display: flex;
        position: absolute;
        bottom: 0px;
        justify-content: space-between;
        padding: 0 8px;
        font-size: 12px;
        font-weight: bold;
    }
.content {
    display: none;
}

.print-heading{
    border-bottom: 1px solid #c4c4c4 !important;
}

.tftable {font-size:12px;color:#333333;width:100%;border: 1px solid #a9a9a9; border-collapse: collapse; margin-top: 25px;margin-bottom:25px;}
.tftable th {font-size:12px;background-color:#e3e3e3;border-width: 1px;padding: 8px;border-style: solid;border-color: #a9a9a9 !important;text-align:left;}
.tftable {background-color:#ffffff;}
.tftable td {font-size:12px;border-width: 1px;padding: 8px;border-style: solid;border-color: #a9a9a9;}
.tftable tr:nth-child(even){
    background: #f7f7f7;
}
.columns-2 p {
    width: 49%;
    float: left;
}
.columns-2 p:nth-child(even) {
    margin-left: 2%;
}
.columns-2 p:nth-child(odd){
    clear: left;
}
.print-format-gutter{
    display: none !important;
}
.page-print .page-header{
    margin: 0 !important;
    border-bottom: none ;
}
.page-header img{
    max-width: 100%;
}
body > .row{
    display: none !important;
}
.signature-table{
    margin-top: 50px;
    border: none !important;
}
.signature-table td{
    border: none !important;
}
/* :not(.printview *){
    display: none;
} */
th{
    text-align: right !important;
}
table{
    -fs-table-paginate: paginate;
}

.table tr td{
  font-weight: 500 !important;
}


.table.table-condensed>tbody>tr>td{
  padding: 8px 8px;
  font-weight: 600 !important;
}

@media print {
   
    @page {
        size: A4;
        margin: 0;
    }
    .printview {
        margin: initial;
        width: initial;
    }
    .toolbar {
        display: none;
    }
    
    .page-print {
        margin: 0;
        border: none;
        border-radius: 0;
        width: 210mm;
        min-height: 297mm;
        max-height: 297mm;
        overflow: hidden;
        box-shadow: 0;
        background: initial;
        page-break-after: always;
    }
    .page-print:last-of-type{
        page-break-after: avoid;
    }
    .page-header, .page-footer, .page-body {
        border: none;
    }
    .content {
        flow: page-flow;
        -webkit-flow: page-flow;
        display: none;
    }
    
    .printview:first-child {
        margin-top: 0;    
    }
    .page:last-child {
        margin-bottom: 0;
    }
    .page-print .page-header{
        margin: 0 !important;
    }
    .tftable th {font-size:12px;}
    .tftable tr:nth-child(even),
    .tftable tr:nth-child(even) td{
        background-color: #f7f7f7 !important;
    }
    
}

.page-footer {
    bottom: 81px;
    /* padding: 0.2cm; */
    /* border-left: 1px #ccc dotted; */
    /* height: 20mm; */
    position: relative;
    text-align: right;
}
    </style>
</head>
<body>    

    <div class="printview">
        <div class="toolbar">
            <button id="print">Print</button>
        </div>
        <div class="page-print">
            <div class="page-header">
            </div>
                    <div class="page-body">
                        {{ body }}
                    </div>
            <div class="page-footer"></div>
        </div>
    </div>
 

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>

    
	<script>

   

    $("table").addClass("tftable");
    
    $.fn.hasOverflow = function () {
        var el = $(this)[0];
        return el.scrollHeight > el.clientHeight;
    };
    $.fn.isTable = function () {
        var el = $(this)[0];
        return el.nodeType === 1 && (el.tagName || '').toUpperCase() === 'TABLE';
    };

    $.fn.withColumns = function(){
        var el = $(this);
        return el.is('[class^="columns"]');
    }

   if($(".letter-head")){
    $(".letter-head").appendTo(".page-header");
    $(".letter-head img").css("max-width","100%");
   }
//    if($(".letter-head-footer")){
//     $(".letter-head-footer").appendTo(".page-footer");
//     $(".letter-head img").css("max-width","100%");
//    }

var g = {}; // Globals
var i = 0;

// function makePage(template) {
//     // console.log('Making a new page');
//     var clone = $('.page-print').first().clone();
//     $(clone).find('.page-body').empty();
//     $(clone).appendTo('.printview');
//     g.currentPage = clone;
//     g.currentPbody  =  getPageBody(clone);
//     return $(clone).hasOverflow()? undefined: clone;
// }

function getPageBody(page) {
    //console.log('Getting the page-body');
    var currentPage = page || makePage();
    return currentPage.find('.page-body');
}
var isFirst = true;
function paginate(content,  page, cont) {
    //console.log('pagination initiated');
    if (!Object.hasOwnProperty(g, 'currentPage')){
        g.currentPage = page || makePage();
    }
    if (!Object.hasOwnProperty(g, 'currentPbody')){
        g.currentPbody = getPageBody(page || g.currentPage || MakePage());
    }

    // <p style="page-break-after: always; page-break-inside: avoid;">&nbsp;</p>
// <p style="page-break-before: always;">&nbsp;</p>
        
    let pageContnet = $(".content").find(".page-break").first().children(),
        length = pageContnet.length;
    
    var currentContent = $(content),
        container;
    if (currentContent.withColumns()){
        container = currentContent.clone().empty().appendTo(g.currentPbody);
    } else if (currentContent.parent().withColumns() && cont){
        container = cont;
    } else {
        container = null;
    }

    var childrens = currentContent.children(),
        l = childrens.size(),
        child;

   
    if($(currentContent).find("hgtable").length && !isFirst){
        currentContent = $(currentContent).find("vhvhvtable")
        paginateTable(currentContent, g.currentPage);
        $(currentContent).remove();
    }else{
        paginateElement(currentContent, g.currentPage)
    }
   
    for (; i < length; i++) {
        isFirst = false;
        $(pageContnet[i]).remove();
        paginate(pageContnet[i],  g.currentPage, container);
    }
}

function paginateElement(node, page, cont) {    
    
    var currentPbody = getPageBody(page || g.currentPage || getMakePage())
        container = node.clone(),
       
        $(node).appendTo(currentPbody);
       
        // console.log($(currentPbody).find(".page-break"))
        if (currentPbody.hasOverflow()) {
            // console.log("aaaaaaaaaaaaa")
            node.detach();
            paginate(container, makePage());
            // break;
        }
   
}

function paginateText(node, page, cont) {
    var currentPbody = getPageBody(page || g.currentPage || getMakePage()),
        container = node.clone().empty(),
        contentText = node.text(),
        wordArray = contentText.split(" "),
        currentText = "",
        i = 0,
        l = wordArray.length,
        oldText,
        word;
        // $(node).remove()
        
    container.appendTo(cont ? cont : currentPbody);
    for (; i < l; i++) {
        word = wordArray[i];
        oldText = currentText;
        currentText += word + " ";
        container.text(currentText);
        // console.log(currentText)
        

        if (currentPbody.hasOverflow()) {
            container.text(oldText);
            paginate(
                node.clone().empty().text(wordArray.slice(i - 1).join(' ')),
                makePage()
            );
            break;
        }
    }
}
let currentThead;
function paginateTable(table, page, cont) {    
    var currentPbody = getPageBody(page || g.currentPage || makePage()),
        container = cont || table.clone(),
        currentTbody = container.find('tbody'),
        currentRows = container.find('tbody > tr'),
        i = 0,
        l = currentRows.length,
        row;
        
        
       
    
    currentTbody.empty();
    container.appendTo(currentPbody);
    
    for (; i < l; i++) {
        row = $(currentRows[i]);
        currentTbody.append(row);
        let thead = $(currentPbody.find(".table").find("thead").last())
        if(thead.length && thead.html() != currentThead){
            currentThead = thead.html()
        }
        if (currentPbody.hasOverflow()) {
            let newThead = `<thead>${$(currentThead).html()}</thead>`;
           
            row.detach();
            container = $(container).clone();
            currentTbody = container.find('tbody');
            
            
            currentTbody.empty().append(currentRows.slice(i));
           
            
            $(container.find("tbody")).wrap('<table class="table table-bordered table-condensed tftable"></table>');
            $(currentThead).prependTo($(container.find(".table")))
            
            paginate(container, makePage());
            break;
        }
    }
}

$(function () {
    let helm = $(".letter-head");
            if(helm.length){
                // console.log(helm.length)
                let helmHight = $(helm).innerHeight();
                // let helmHight = $(helm).css("height");
                // console.log($(helm).css("height"))
                let current = $(".page-body").css("height");
                // console.log(helmHight)
                // console.log(current)
                $(".page-body").css("height",'215mm');
                $(".page-body").css("margin-bottom",'32px');
            }
    paginate(
        $('.content'),
        $('.page-print'),
        // $('.page-break')
    );
  
    var pages = $('.page-print').length,
        date = new Date(),
        tDate = date.getDate() + '/' + (date.getMonth() + 1) + '/' + date.getFullYear();
        $('.page-print').each(function (i, p) {
            var foot = $(this).find('.page-footer');
            $(`<div id="page-${i}"></div>`).appendTo($(foot));
            let f = $(".letter-head-footer").html();
            $('<div class="footer-pagination"><span></span><span>صفحة ' + (1 + i) + ' من ' + pages + '</span></div>').appendTo($(`#page-${i}`));
            $(f).addClass("letter-head-footer").appendTo($(`#page-${i}`))
            let felm = $(".letter-head-footer");
            if(!felm.length){
                let current = $(".page-body").css("height");
                $(".page-body").css("height",`calc(${current} + 20px)`);
            }
        })
       
    $('#print').click(function (ev) {
        window.print();
    });
});
	</script>
</body>
{%- if comment -%}
<!-- {{ comment }} -->
{%- endif -%}
</html>
